<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Prueba RÃ¡pida - Flechas del Diagrama</title>
    <style>
        .diagram-canvas {
            min-height: 600px;
            min-width: 800px;
            background-color: white;
            border: 2px dashed #dee2e6;
            border-radius: 8px;
            position: relative;
            overflow: visible;
            background-image: 
                linear-gradient(rgba(0,0,0,.1) 1px, transparent 1px),
                linear-gradient(90deg, rgba(0,0,0,.1) 1px, transparent 1px);
            background-size: 20px 20px;
        }
        
        .diagram-node {
            position: absolute;
            border: 2px solid #0d6efd;
            border-radius: 8px;
            background-color: white;
            padding: 8px;
            cursor: move;
            user-select: none;
            min-width: 80px;
            min-height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            z-index: 100;
        }
        
        .diagram-connection {
            position: absolute;
            pointer-events: none;
            z-index: 50;
            width: 100%;
            height: 100%;
        }
        
        .diagram-connection svg {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            overflow: visible;
        }
        
        .diagram-connection svg line {
            stroke-width: 3;
            stroke: #0d6efd;
            stroke-linecap: round;
        }
        
        .diagram-connection svg marker {
            stroke: #0d6efd;
            fill: #0d6efd;
        }
    </style>
</head>
<body>
    <h1>ðŸ§ª Prueba RÃ¡pida - Flechas del Diagrama</h1>
    <p>Este es un test para verificar que las flechas se rendericen correctamente.</p>
    
    <div class="diagram-canvas" id="testCanvas">
        <!-- Los nodos y conexiones se crearÃ¡n aquÃ­ -->
    </div>
    
    <script>
        // FunciÃ³n para crear nodos de prueba
        function createTestNode(id, text, x, y, width, height) {
            const canvas = document.getElementById('testCanvas');
            const node = document.createElement('div');
            
            node.className = 'diagram-node';
            node.id = id;
            node.style.left = x + 'px';
            node.style.top = y + 'px';
            node.style.width = width + 'px';
            node.style.height = height + 'px';
            node.textContent = text;
            
            canvas.appendChild(node);
            return node;
        }
        
        // FunciÃ³n para crear conexiones de prueba
        function createTestConnection(id, fromNode, toNode, label) {
            const canvas = document.getElementById('testCanvas');
            const connection = document.createElement('div');
            
            connection.className = 'diagram-connection';
            connection.id = id;
            
            // Calcular posiciones
            const fromRect = fromNode.getBoundingClientRect();
            const toRect = toNode.getBoundingClientRect();
            const canvasRect = canvas.getBoundingClientRect();
            
            const fromX = fromRect.left - canvasRect.left + fromRect.width / 2;
            const fromY = fromRect.top - canvasRect.top + fromRect.height / 2;
            const toX = toRect.left - canvasRect.left + toRect.width / 2;
            const toY = toRect.top - canvasRect.top + toRect.height / 2;
            
            // Crear SVG
            const svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
            svg.style.position = 'absolute';
            svg.style.left = '0';
            svg.style.top = '0';
            svg.style.width = '100%';
            svg.style.height = '100%';
            svg.style.pointerEvents = 'none';
            svg.style.zIndex = '1000';
            
            // Definiciones para la flecha
            const defs = document.createElementNS('http://www.w3.org/2000/svg', 'defs');
            const marker = document.createElementNS('http://www.w3.org/2000/svg', 'marker');
            marker.setAttribute('id', `arrowhead-${id}`);
            marker.setAttribute('markerWidth', '10');
            marker.setAttribute('markerHeight', '7');
            marker.setAttribute('refX', '9');
            marker.setAttribute('refY', '3.5');
            marker.setAttribute('orient', 'auto');
            
            const polygon = document.createElementNS('http://www.w3.org/2000/svg', 'polygon');
            polygon.setAttribute('points', '0 0, 10 3.5, 0 7');
            polygon.setAttribute('fill', '#0d6efd');
            
            marker.appendChild(polygon);
            defs.appendChild(marker);
            svg.appendChild(defs);
            
            // LÃ­nea con flecha
            const line = document.createElementNS('http://www.w3.org/2000/svg', 'line');
            line.setAttribute('x1', fromX);
            line.setAttribute('y1', fromY);
            line.setAttribute('x2', toX);
            line.setAttribute('y2', toY);
            line.setAttribute('stroke', '#0d6efd');
            line.setAttribute('stroke-width', '3');
            line.setAttribute('marker-end', `url(#arrowhead-${id})`);
            
            svg.appendChild(line);
            
            // Etiqueta si existe
            if (label) {
                const labelX = (fromX + toX) / 2;
                const labelY = (fromY + toY) / 2 - 15;
                
                const text = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                text.setAttribute('x', labelX);
                text.setAttribute('y', labelY);
                text.setAttribute('text-anchor', 'middle');
                text.setAttribute('font-family', 'Arial');
                text.setAttribute('font-size', '12');
                text.setAttribute('fill', '#333');
                text.setAttribute('font-weight', 'bold');
                text.textContent = label;
                
                svg.appendChild(text);
            }
            
            connection.appendChild(svg);
            connection.style.position = 'absolute';
            connection.style.left = '0';
            connection.style.top = '0';
            connection.style.width = '100%';
            connection.style.height = '100%';
            connection.style.pointerEvents = 'none';
            connection.style.zIndex = '1000';
            
            canvas.appendChild(connection);
            
            console.log(`âœ… ConexiÃ³n de prueba creada: ${id}`);
        }
        
        // Crear diagrama de prueba
        function createTestDiagram() {
            console.log('ðŸš€ Creando diagrama de prueba...');
            
            // Crear nodos
            const node1 = createTestNode('node1', 'VNet Principal', 100, 100, 200, 100);
            const node2 = createTestNode('node2', 'VM Web', 400, 100, 120, 80);
            const node3 = createTestNode('node3', 'Database', 400, 300, 120, 80);
            
            // Esperar un momento para que los nodos se rendericen
            setTimeout(() => {
                // Crear conexiones
                createTestConnection('edge1', node1, node2, 'Network');
                createTestConnection('edge2', node2, node3, 'Data');
                createTestConnection('edge3', node1, node3, 'Direct');
                
                console.log('âœ… Diagrama de prueba creado completamente');
            }, 100);
        }
        
        // Ejecutar cuando se carga la pÃ¡gina
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ðŸ“± PÃ¡gina cargada, creando diagrama de prueba...');
            createTestDiagram();
        });
    </script>
</body>
</html>
