// Azure Icons - Official Microsoft Azure Service Icons
const AzureIcons = {
    // Virtual Networks and Subnets
    azure_vnet: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 18 18"><defs><linearGradient id="f020fb7e-2243-4501-8153-5d69bd3c34f7" x1="9.88" y1="8.59" x2="11.52" y2="10.23" gradientTransform="translate(2.03 -0.4) rotate(-0.08)" gradientUnits="userSpaceOnUse"><stop offset="0" stop-color="#86d633" /><stop offset="1" stop-color="#5e9624" /></linearGradient><linearGradient id="b3c2bc94-8c7c-48a2-9719-6ee899a43a97" x1="6.18" y1="8.59" x2="7.81" y2="10.23" gradientUnits="userSpaceOnUse"><stop offset="0" stop-color="#86d633" /><stop offset="1" stop-color="#5e9624" /></linearGradient><linearGradient id="e900c35d-0958-4d4f-b28f-302eeaaf52f5" x1="2.48" y1="8.59" x2="4.11" y2="10.23" gradientUnits="userSpaceOnUse"><stop offset="0" stop-color="#86d633" /><stop offset="1" stop-color="#5e9624" /></linearGradient></defs><title>Virtual Networks</title><circle cx="12.74" cy="8.99" r="1.16" fill="url(#f020fb7e-2243-4501-8153-5d69bd3c34f7)" /><circle cx="9.04" cy="9" r="1.16" fill="url(#b3c2bc94-8c7c-48a2-9719-6ee899a43a97)" /><circle cx="5.34" cy="9" r="1.16" fill="url(#e900c35d-0958-4d4f-b28f-302eeaaf52f5)" /><path d="M2.61,7.28h.94a.3.3,0,0,1,.3.3v6.94a.6.6,0,0,1-.6.6H2.31a0,0,0,0,1,0,0V7.58a.3.3,0,0,1,.3-.3Z" transform="translate(13.18 16.93) rotate(134.92)" fill="#50e6ff" /><path d="M2.56,2.91H3.5a.3.3,0,0,1,.3.3v7.43a0,0,0,0,1,0,0H2.86a.6.6,0,0,1-.6-.6V3.21a.3.3,0,0,1,.3-.3Z" transform="translate(5.66 -0.16) rotate(44.92)" fill="#1490df" /><path d="M14.15,7.28h.94a.6.6,0,0,1,.6.6v6.94a.3.3,0,0,1-.3.3h-.94a.3.3,0,0,1-.3-.3V7.28a0,0,0,0,1,0,0Z" transform="translate(12.32 -7.28) rotate(45.08)" fill="#50e6ff" /><path d="M14.81,2.91h.94a0,0,0,0,1,0,0v7.43a.3.3,0,0,1-.3.3H14.5a.3.3,0,0,1-.3-.3V3.51a.6.6,0,0,1,.6-.6Z" transform="translate(30.36 0.99) rotate(135.08)" fill="#1490df" /></svg>`,
    
    azure_subnet: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 18 18"><defs><linearGradient id="f020fb7e-2243-4501-8153-5d69bd3c34f7" x1="9.88" y1="8.59" x2="11.52" y2="10.23" gradientTransform="translate(2.03 -0.4) rotate(-0.08)" gradientUnits="userSpaceOnUse"><stop offset="0" stop-color="#86d633" /><stop offset="1" stop-color="#5e9624" /></linearGradient><linearGradient id="b3c2bc94-8c7c-48a2-9719-6ee899a43a97" x1="6.18" y1="8.59" x2="7.81" y2="10.23" gradientUnits="userSpaceOnUse"><stop offset="0" stop-color="#86d633" /><stop offset="1" stop-color="#5e9624" /></linearGradient><linearGradient id="e900c35d-0958-4d4f-b28f-302eeaaf52f5" x1="2.48" y1="8.59" x2="4.11" y2="10.23" gradientUnits="userSpaceOnUse"><stop offset="0" stop-color="#86d633" /><stop offset="1" stop-color="#5e9624" /></linearGradient></defs><title>Subnet</title><circle cx="12.74" cy="8.99" r="1.16" fill="url(#f020fb7e-2243-4501-8153-5d69bd3c34f7)" /><circle cx="9.04" cy="9" r="1.16" fill="url(#b3c2bc94-8c7c-48a2-9719-6ee899a43a97)" /><circle cx="5.34" cy="9" r="1.16" fill="url(#e900c35d-0958-4d4f-b28f-302eeaaf52f5)" /><path d="M2.61,7.28h.94a.3.3,0,0,1,.3.3v6.94a.6.6,0,0,1-.6.6H2.31a0,0,0,0,1,0,0V7.58a.3.3,0,0,1,.3-.3Z" transform="translate(13.18 16.93) rotate(134.92)" fill="#50e6ff" /><path d="M2.56,2.91H3.5a.3.3,0,0,1,.3.3v7.43a0,0,0,0,1,0,0H2.86a.6.6,0,0,1-.6-.6V3.21a.3.3,0,0,1,.3-.3Z" transform="translate(5.66 -0.16) rotate(44.92)" fill="#1490df" /><path d="M14.15,7.28h.94a.6.6,0,0,1,.6.6v6.94a.3.3,0,0,1-.3.3h-.94a.3.3,0,0,1-.3-.3V7.28a0,0,0,0,1,0,0Z" transform="translate(12.32 -7.28) rotate(45.08)" fill="#50e6ff" /><path d="M14.81,2.91h.94a0,0,0,0,1,0,0v7.43a.3.3,0,0,1-.3.3H14.5a.3.3,0,0,1-.3-.3V3.51a.6.6,0,0,1,.6-.6Z" transform="translate(30.36 0.99) rotate(135.08)" fill="#1490df" /></svg>`,
    
    // Virtual Machines
    azure_vm: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 18 18"><defs><linearGradient id="f34d9569-2bd0-4002-8f16-3d01d8106cb5" x1="8.88" y1="12.21" x2="8.88" y2="0.21" gradientUnits="userSpaceOnUse"><stop offset="0" stop-color="#0078d4" /><stop offset="0.82" stop-color="#5ea0ef" /></linearGradient><linearGradient id="bdb45a0b-eb58-4970-a60a-fb2ce314f866" x1="8.88" y1="16.84" x2="8.88" y2="12.21" gradientUnits="userSpaceOnUse"><stop offset="0.15" stop-color="#ccc" /><stop offset="1" stop-color="#707070" /></linearGradient></defs><title>Virtual Machine</title><rect x="-0.12" y="0.21" width="18" height="12" rx="0.6" fill="url(#f34d9569-2bd0-4002-8f16-3d01d8106cb5)" /><polygon points="11.88 4.46 11.88 7.95 8.88 9.71 8.88 6.21 11.88 4.46" fill="#50e6ff" /><polygon points="11.88 4.46 8.88 6.22 5.88 4.46 8.88 2.71 11.88 4.46" fill="#c3f1ff" /><polygon points="8.88 6.22 8.88 9.71 5.88 7.95 5.88 4.46 8.88 6.22" fill="#9cebff" /><polygon points="5.88 7.95 8.88 6.21 8.88 9.71 5.88 7.95" fill="#c3f1ff" /><polygon points="11.88 7.95 8.88 6.21 8.88 9.71 11.88 7.95" fill="#9cebff" /><path d="M12.49,15.84c-1.78-.28-1.85-1.56-1.85-3.63H7.11c0,2.07-.06,3.35-1.84,3.63a1,1,0,0,0-.89,1h9A1,1,0,0,0,12.49,15.84Z" fill="url(#bdb45a0b-eb58-4970-a60a-fb2ce314f866)" /></svg>`,
    
    // App Services
    azure_app_service: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 18 18"><defs><linearGradient id="f34d9569-2bd0-4002-8f16-3d01d8106cb5" x1="8.88" y1="12.21" x2="8.88" y2="0.21" gradientUnits="userSpaceOnUse"><stop offset="0" stop-color="#0078d4" /><stop offset="0.82" stop-color="#5ea0ef" /></linearGradient><linearGradient id="bdb45a0b-eb58-4970-a60a-fb2ce314f866" x1="8.88" y1="16.84" x2="8.88" y2="12.21" gradientUnits="userSpaceOnUse"><stop offset="0.15" stop-color="#ccc" /><stop offset="1" stop-color="#707070" /></linearGradient></defs><title>App Service</title><rect x="-0.12" y="0.21" width="18" height="12" rx="0.6" fill="url(#f34d9569-2bd0-4002-8f16-3d01d8106cb5)" /><polygon points="11.88 4.46 11.88 7.95 8.88 9.71 8.88 6.21 11.88 4.46" fill="#50e6ff" /><polygon points="11.88 4.46 8.88 6.22 5.88 4.46 8.88 2.71 11.88 4.46" fill="#c3f1ff" /><polygon points="8.88 6.22 8.88 9.71 5.88 7.95 5.88 4.46 8.88 6.22" fill="#9cebff" /><polygon points="5.88 7.95 8.88 6.21 8.88 9.71 5.88 7.95" fill="#c3f1ff" /><polygon points="11.88 7.95 8.88 6.21 8.88 9.71 11.88 7.95" fill="#9cebff" /><path d="M12.49,15.84c-1.78-.28-1.85-1.56-1.85-3.63H7.11c0,2.07-.06,3.35-1.84,3.63a1,1,0,0,0-.89,1h9A1,1,0,0,0,12.49,15.84Z" fill="url(#bdb45a0b-eb58-4970-a60a-fb2ce314f866)" /></svg>`,
    
    // SQL Database
    azure_sql: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 18 18"><defs><linearGradient id="ef16bf9d-a8b6-4181-b6cd-66fc5203f956" x1="2.59" y1="10.16" x2="15.41" y2="10.16" gradientUnits="userSpaceOnUse"><stop offset="0" stop-color="#005ba1" /><stop offset="0.07" stop-color="#0060a9" /><stop offset="0.36" stop-color="#0071c8" /><stop offset="0.52" stop-color="#0078d4" /><stop offset="0.64" stop-color="#0074cd" /><stop offset="0.82" stop-color="#006abb" /><stop offset="1" stop-color="#005ba1" /></linearGradient><radialGradient id="bf3846c3-4d74-4743-ab9a-f334c248bd92" cx="9.36" cy="10.57" r="7.07" gradientUnits="userSpaceOnUse"><stop offset="0" stop-color="#f2f2f2" /><stop offset="0.58" stop-color="#eee" /><stop offset="1" stop-color="#e6e6e6" /></radialGradient></defs><title>SQL Database</title><path d="M9,5.14c-3.54,0-6.41-1-6.41-2.32V15.18c0,1.27,2.82,2.3,6.32,2.32H9c3.54,0,6.41-1,6.41-2.32V2.82C15.41,4.11,12.54,5.14,9,5.14Z" fill="url(#ef16bf9d-a8b6-4181-b6cd-66fc5203f956)" /><path d="M15.41,2.82c0,1.29-2.87,2.32-6.41,2.32s-6.41-1-6.41-2.32S5.46.5,9,.5s6.41,1,6.41,2.32" fill="#e8e8e8" /><path d="M13.92,2.63c0,.82-2.21,1.48-4.92,1.48S4.08,3.45,4.08,2.63,6.29,1.16,9,1.16s4.92.66,4.92,1.47" fill="#50e6ff" /><path d="M9,3a11.55,11.55,0,0,0-3.89.57A11.42,11.42,0,0,0,9,4.11a11.15,11.15,0,0,0,3.89-.58A11.84,11.84,0,0,0,9,3Z" fill="#198ab3" /></svg>`,
    
    // Firewall
    azure_firewall: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 18 18"><defs><linearGradient id="f34d9569-2bd0-4002-8f16-3d01d8106cb5" x1="8.88" y1="12.21" x2="8.88" y2="0.21" gradientUnits="userSpaceOnUse"><stop offset="0" stop-color="#d13438" /><stop offset="0.82" stop-color="#e81123" /></linearGradient></defs><title>Azure Firewall</title><rect x="-0.12" y="0.21" width="18" height="12" rx="0.6" fill="url(#f34d9569-2bd0-4002-8f16-3d01d8106cb5)" /><path d="M2.88,6.21h12.24v6h-12.24Z" fill="#fff" opacity="0.2"/><path d="M8.88,2.21l2,4h-4Z" fill="#fff"/><circle cx="8.88" cy="9.21" r="1.5" fill="#d13438"/></svg>`,
    
    // Internet
    internet: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 18 18"><defs><radialGradient id="internet_gradient" cx="9" cy="9" r="9" gradientUnits="userSpaceOnUse"><stop offset="0" stop-color="#0078d4" /><stop offset="1" stop-color="#004e8c" /></radialGradient></defs><title>Internet</title><circle cx="9" cy="9" r="8" fill="url(#internet_gradient)"/><path d="M1,9a8,8,0,0,1,16,0" fill="none" stroke="#fff" stroke-width="1"/><path d="M9,1a8,8,0,0,1,0,16" fill="none" stroke="#fff" stroke-width="1" opacity="0.7"/><circle cx="9" cy="9" r="3" fill="#fff" opacity="0.3"/></svg>`,
    
    // On-Premises
    on_premises: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 18 18"><defs><linearGradient id="onprem_gradient" x1="0" y1="0" x2="18" y2="18" gradientUnits="userSpaceOnUse"><stop offset="0" stop-color="#666" /><stop offset="1" stop-color="#333" /></linearGradient></defs><title>On-Premises</title><rect x="2" y="4" width="14" height="10" rx="1" fill="url(#onprem_gradient)"/><rect x="4" y="6" width="10" height="6" fill="#fff" opacity="0.2"/><path d="M9,2l2,2h-4Z" fill="#666"/></svg>`,
    
    // Bastion
    azure_bastion: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 18 18"><defs><linearGradient id="bastion_gradient" x1="0" y1="0" x2="18" y2="18" gradientUnits="userSpaceOnUse"><stop offset="0" stop-color="#86d633" /><stop offset="1" stop-color="#5e9624" /></linearGradient></defs><title>Azure Bastion</title><rect x="2" y="4" width="14" height="10" rx="1" fill="url(#bastion_gradient)"/><rect x="4" y="6" width="10" height="6" fill="#fff" opacity="0.2"/><path d="M9,2l2,2h-4Z" fill="#86d633"/><circle cx="9" cy="9" r="1.5" fill="#fff"/></svg>`,
    
    // Express Route
    azure_express_route: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 18 18"><defs><linearGradient id="express_gradient" x1="0" y1="0" x2="18" y2="18" gradientUnits="userSpaceOnUse"><stop offset="0" stop-color="#0078d4" /><stop offset="1" stop-color="#004e8c" /></linearGradient></defs><title>Express Route</title><rect x="2" y="4" width="14" height="10" rx="1" fill="url(#express_gradient)"/><rect x="4" y="6" width="10" height="6" fill="#fff" opacity="0.2"/><path d="M9,2l2,2h-4Z" fill="#0078d4"/><path d="M6,9h6M6,11h6" stroke="#fff" stroke-width="1" fill="none"/></svg>`,
    
    // Shared Services
    azure_shared_services: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 18 18"><defs><linearGradient id="shared_gradient" x1="0" y1="0" x2="18" y2="18" gradientUnits="userSpaceOnUse"><stop offset="0" stop-color="#ff8c00" /><stop offset="1" stop-color="#d67600" /></linearGradient></defs><title>Shared Services</title><rect x="2" y="4" width="14" height="10" rx="1" fill="url(#shared_gradient)"/><rect x="4" y="6" width="10" height="6" fill="#fff" opacity="0.2"/><path d="M9,2l2,2h-4Z" fill="#ff8c00"/><circle cx="7" cy="9" r="1"/><circle cx="11" cy="9" r="1"/><path d="M7,11h4" stroke="#fff" stroke-width="1" fill="none"/></svg>`,
    
    // Diagram Title
    diagram_title: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 18 18"><defs><linearGradient id="title_gradient" x1="0" y1="0" x2="18" y2="18" gradientUnits="userSpaceOnUse"><stop offset="0" stop-color="#0078d4" /><stop offset="1" stop-color="#004e8c" /></linearGradient></defs><title>Diagram Title</title><rect x="1" y="1" width="16" height="16" rx="2" fill="url(#title_gradient)"/><text x="9" y="11" text-anchor="middle" fill="#fff" font-size="10" font-weight="bold">TITLE</text></svg>`,
    
    // Monitoring
    azure_monitoring: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 18 18"><defs><linearGradient id="monitor_gradient" x1="0" y1="0" x2="18" y2="18" gradientUnits="userSpaceOnUse"><stop offset="0" stop-color="#0078d4" /><stop offset="1" stop-color="#004e8c" /></linearGradient></defs><title>Azure Monitor</title><rect x="2" y="4" width="14" height="10" rx="1" fill="url(#monitor_gradient)"/><rect x="4" y="6" width="10" height="6" fill="#fff" opacity="0.2"/><path d="M9,2l2,2h-4Z" fill="#0078d4"/><path d="M6,9l2,2 4-4" stroke="#fff" stroke-width="1.5" fill="none" stroke-linecap="round" stroke-linejoin="round"/></svg>`,
    
    // VPN Gateway
    azure_vpn_gateway: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 18 18"><defs><linearGradient id="vpn_gradient" x1="0" y1="0" x2="18" y2="18" gradientUnits="userSpaceOnUse"><stop offset="0" stop-color="#86d633" /><stop offset="1" stop-color="#5e9624" /></linearGradient></defs><title>VPN Gateway</title><rect x="2" y="4" width="14" height="10" rx="1" fill="url(#vpn_gradient)"/><rect x="4" y="6" width="10" height="6" fill="#fff" opacity="0.2"/><path d="M9,2l2,2h-4Z" fill="#86d633"/><path d="M6,9h6M6,11h6" stroke="#fff" stroke-width="1" fill="none"/><circle cx="9" cy="9" r="1" fill="#fff"/></svg>`,
    
    // Key Vault
    azure_key_vault: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 18 18"><defs><linearGradient id="keyvault_gradient" x1="0" y1="0" x2="18" y2="18" gradientUnits="userSpaceOnUse"><stop offset="0" stop-color="#ff8c00" /><stop offset="1" stop-color="#d67600" /></linearGradient></defs><title>Key Vault</title><rect x="2" y="4" width="14" height="10" rx="1" fill="url(#keyvault_gradient)"/><rect x="4" y="6" width="10" height="6" fill="#fff" opacity="0.2"/><path d="M9,2l2,2h-4Z" fill="#ff8c00"/><path d="M7,9h4M7,11h4" stroke="#fff" stroke-width="1" fill="none"/><circle cx="9" cy="9" r="0.8" fill="#fff"/></svg>`,
    
    // Subscription
    azure_subscription: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 18 18"><defs><linearGradient id="sub_gradient" x1="0" y1="0" x2="18" y2="18" gradientUnits="userSpaceOnUse"><stop offset="0" stop-color="#0078d4" /><stop offset="1" stop-color="#004e8c" /></linearGradient></defs><title>Azure Subscription</title><rect x="2" y="4" width="14" height="10" rx="1" fill="url(#sub_gradient)"/><rect x="4" y="6" width="10" height="6" fill="#fff" opacity="0.2"/><path d="M9,2l2,2h-4Z" fill="#0078d4"/><path d="M6,9h6M6,11h6" stroke="#fff" stroke-width="1" fill="none"/><circle cx="9" cy="9" r="1" fill="#fff"/></svg>`,
    
    // Generic icons for other node types
    start: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 18 18"><defs><radialGradient id="start_gradient" cx="9" cy="9" r="9" gradientUnits="userSpaceOnUse"><stop offset="0" stop-color="#107c10" /><stop offset="1" stop-color="#0b5a0b" /></radialGradient></defs><title>Start</title><circle cx="9" cy="9" r="8" fill="url(#start_gradient)"/><text x="9" y="12" text-anchor="middle" fill="#fff" font-size="8" font-weight="bold">START</text></svg>`,
    
    process: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 18 18"><defs><linearGradient id="process_gradient" x1="0" y1="0" x2="18" y2="18" gradientUnits="userSpaceOnUse"><stop offset="0" stop-color="#0078d4" /><stop offset="1" stop-color="#004e8c" /></linearGradient></defs><title>Process</title><rect x="2" y="4" width="14" height="10" rx="1" fill="url(#process_gradient)"/><text x="9" y="11" text-anchor="middle" fill="#fff" font-size="8" font-weight="bold">PROCESS</text></svg>`,
    
    decision: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 18 18"><defs><linearGradient id="decision_gradient" x1="0" y1="0" x2="18" y2="18" gradientUnits="userSpaceOnUse"><stop offset="0" stop-color="#ff8c00" /><stop offset="1" stop-color="#d67600" /></linearGradient></defs><title>Decision</title><polygon points="9,2 16,9 9,16 2,9" fill="url(#decision_gradient)"/><text x="9" y="11" text-anchor="middle" fill="#fff" font-size="6" font-weight="bold">DECISION</text></svg>`,
    
    end: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 18 18"><defs><radialGradient id="end_gradient" cx="9" cy="9" r="9" gradientUnits="userSpaceOnUse"><stop offset="0" stop-color="#d13438" /><stop offset="1" stop-color="#a4262c" /></radialGradient></defs><title>End</title><circle cx="9" cy="9" r="8" fill="url(#end_gradient)"/><text x="9" y="12" text-anchor="middle" fill="#fff" font-size="8" font-weight="bold">END</text></svg>`,
    
    system: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 18 18"><defs><linearGradient id="system_gradient" x1="0" y1="0" x2="18" y2="18" gradientUnits="userSpaceOnUse"><stop offset="0" stop-color="#68217a" /><stop offset="1" stop-color="#4a1482" /></linearGradient></defs><title>System</title><rect x="2" y="4" width="14" height="10" rx="1" fill="url(#system_gradient)"/><text x="9" y="11" text-anchor="middle" fill="#fff" font-size="8" font-weight="bold">SYSTEM</text></svg>`,
    
    database: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 18 18"><defs><linearGradient id="db_gradient" x1="0" y1="0" x2="18" y2="18" gradientUnits="userSpaceOnUse"><stop offset="0" stop-color="#005ba1" /><stop offset="1" stop-color="#004e8c" /></linearGradient></defs><title>Database</title><ellipse cx="9" cy="4" rx="6" ry="2" fill="url(#db_gradient)"/><rect x="3" y="4" width="12" height="8" fill="url(#db_gradient)"/><ellipse cx="9" cy="12" rx="6" ry="2" fill="url(#db_gradient)"/><text x="9" y="10" text-anchor="middle" fill="#fff" font-size="6" font-weight="bold">DB</text></svg>`,
    
    external: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 18 18"><defs><linearGradient id="external_gradient" x1="0" y1="0" x2="18" y2="18" gradientUnits="userSpaceOnUse"><stop offset="0" stop-color="#666" /><stop offset="1" stop-color="#333" /></linearGradient></defs><title>External</title><rect x="2" y="4" width="14" height="10" rx="1" fill="url(#external_gradient)"/><text x="9" y="11" text-anchor="middle" fill="#fff" font-size="8" font-weight="bold">EXTERNAL</text></svg>`,
    
    interface: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 18 18"><defs><linearGradient id="interface_gradient" x1="0" y1="0" x2="18" y2="18" gradientUnits="userSpaceOnUse"><stop offset="0" stop-color="#ff8c00" /><stop offset="1" stop-color="#d67600" /></linearGradient></defs><title>Interface</title><rect x="2" y="4" width="14" height="10" rx="1" fill="url(#interface_gradient)"/><text x="9" y="11" text-anchor="middle" fill="#fff" font-size="7" font-weight="bold">INTERFACE</text></svg>`,
    
    abstract: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 18 18"><defs><linearGradient id="abstract_gradient" x1="0" y1="0" x2="18" y2="18" gradientUnits="userSpaceOnUse"><stop offset="0" stop-color="#68217a" /><stop offset="1" stop-color="#4a1482" /></linearGradient></defs><title>Abstract</title><rect x="2" y="4" width="14" height="10" rx="1" fill="url(#abstract_gradient)"/><text x="9" y="11" text-anchor="middle" fill="#fff" font-size="7" font-weight="bold">ABSTRACT</text></svg>`,
    
    relationship: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 18 18"><defs><linearGradient id="relationship_gradient" x1="0" y1="0" x2="18" y2="18" gradientUnits="userSpaceOnUse"><stop offset="0" stop-color="#86d633" /><stop offset="1" stop-color="#5e9624" /></linearGradient></defs><title>Relationship</title><rect x="2" y="4" width="14" height="10" rx="1" fill="url(#relationship_gradient)"/><text x="9" y="11" text-anchor="middle" fill="#fff" font-size="6" font-weight="bold">RELATION</text></svg>`,
    
    attribute: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 18 18"><defs><linearGradient id="attribute_gradient" x1="0" y1="0" x2="18" y2="18" gradientUnits="userSpaceOnUse"><stop offset="0" stop-color="#0078d4" /><stop offset="1" stop-color="#004e8c" /></linearGradient></defs><title>Attribute</title><rect x="2" y="4" width="14" height="10" rx="1" fill="url(#attribute_gradient)"/><text x="9" y="11" text-anchor="middle" fill="#fff" font-size="7" font-weight="bold">ATTRIBUTE</text></svg>`
};

// Function to get Azure icon by type
function getAzureIcon(type) {
    return AzureIcons[type] || AzureIcons['process'];
}

// Function to create professional arrow connections
function createArrowConnection(fromElement, toElement, connectionType = 'default') {
    if (!fromElement || !toElement) {
        console.warn('Cannot create connection: missing elements');
        return null;
    }
    
    const fromRect = fromElement.getBoundingClientRect();
    const toRect = toElement.getBoundingClientRect();
    const canvasRect = document.getElementById('canvas').getBoundingClientRect();
    
    // Calculate start and end points
    const startX = fromRect.left + fromRect.width / 2 - canvasRect.left;
    const startY = fromRect.top + fromRect.height / 2 - canvasRect.top;
    const endX = toRect.left + toRect.width / 2 - canvasRect.left;
    const endY = toRect.top + toRect.height / 2 - canvasRect.top;
    
    // Create SVG element
    const svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
    svg.setAttribute('width', '100%');
    svg.setAttribute('height', '100%');
    svg.style.position = 'absolute';
    svg.style.top = '0';
    svg.style.left = '0';
    svg.style.pointerEvents = 'none';
    svg.style.zIndex = '1000';
    
    // Create arrow marker
    const defs = document.createElementNS('http://www.w3.org/2000/svg', 'defs');
    const marker = document.createElementNS('http://www.w3.org/2000/svg', 'marker');
    marker.setAttribute('id', `arrow-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`);
    marker.setAttribute('markerWidth', '12');
    marker.setAttribute('markerHeight', '8');
    marker.setAttribute('refX', '10');
    marker.setAttribute('refY', '4');
    marker.setAttribute('orient', 'auto');
    
    const polygon = document.createElementNS('http://www.w3.org/2000/svg', 'polygon');
    polygon.setAttribute('points', '0 0, 12 4, 0 8');
    polygon.setAttribute('fill', '#2563eb');
    
    marker.appendChild(polygon);
    defs.appendChild(marker);
    svg.appendChild(defs);
    
    // Create connection line
    const line = document.createElementNS('http://www.w3.org/2000/svg', 'line');
    line.setAttribute('x1', startX);
    line.setAttribute('y1', startY);
    line.setAttribute('x2', endX);
    line.setAttribute('y2', endY);
    line.setAttribute('stroke', '#2563eb');
    line.setAttribute('stroke-width', '3');
    line.setAttribute('marker-end', `url(#${marker.getAttribute('id')})`);
    line.setAttribute('stroke-linecap', 'round');
    
    svg.appendChild(line);
    
    return svg;
}

// Function to update all connections
function updateAllConnections() {
    console.log('Updating all connections...');
    
    // Clear existing connections
    const existingConnections = document.querySelectorAll('.connection-svg');
    existingConnections.forEach(conn => conn.remove());
    
    // Recreate connections
    if (window.currentDiagram && window.currentDiagram.data && window.currentDiagram.data.edges) {
        console.log('Current diagram edges:', window.currentDiagram.data.edges);
        
        window.currentDiagram.data.edges.forEach((edge, index) => {
            console.log(`Processing edge ${index}:`, edge.from, '->', edge.to);
            
            const fromElement = document.getElementById(edge.from);
            const toElement = document.getElementById(edge.to);
            
            console.log('From element:', fromElement);
            console.log('To element:', toElement);
            
            if (fromElement && toElement) {
                const connection = createArrowConnection(fromElement, toElement);
                if (connection) {
                    connection.classList.add('connection-svg');
                    document.getElementById('canvas').appendChild(connection);
                    console.log(`Connection created between ${edge.from} and ${edge.to}`);
                }
            } else {
                console.warn(`Could not find elements for connection: ${edge.from} -> ${edge.to}`);
            }
        });
    } else {
        console.warn('No current diagram or edges data available');
    }
}
